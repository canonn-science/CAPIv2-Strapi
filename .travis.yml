dist: xenial
language: node_js
services:
  - mysql
addons:
  mariadb: '10.0'
  apt:
    sources:
      - sourceline: 'deb http://apt.pm2.io/ubuntu stable main'
        key_url: 'http://apt.pm2.io/ubuntu/apt.pm2.io.gpg.key'
    packages:
      - software-properties-common
      - build-essential
      - pm2
node_js:
  - '10'

before_install:
  - sudo apt-key adv --keyserver keyserver.ubuntu.com --recv D1EA2D4C
  - echo "deb http://apt.pm2.io/ubuntu stable main" | sudo tee /etc/apt/sources.list.d/pm2.list
  - sudo apt-get update
  - sudo apt-get install pm2

install:
  - npm install

script:
  - pm2 start strapi --no-pmx --name="capiv2" -- start
  - pm2 stop capiv2
